-- Eliminar tabla de registros
DROP TABLE
IF EXISTS cortes_transversales.registro_refresh_matview;

-- Eliminar secuencia
DROP SEQUENCE
IF EXISTS cortes_transversales.id_registro_refresh_matview_seq;

-- Crear secuencia
CREATE SEQUENCE cortes_transversales.id_registro_refresh_matview_seq;

-- Crear tabla de registro para automatizar los refresh de la vista materializada
CREATE TABLE cortes_transversales.registro_refresh_matview (
	"id_registro_refresh_matview" int8 DEFAULT nextval(
		'cortes_transversales.id_registro_refresh_matview_seq' :: regclass
	) NOT NULL,
	"fechahora_modificacion" TIMESTAMP NOT NULL,
	"fechahora_proceso" TIMESTAMP,
	"requiere_refresh" BOOLEAN NOT NULL,
	"tiempo_ejecucion" INTERVAL,
	PRIMARY KEY (
		"id_registro_refresh_matview"
	)
) WITH (OIDS = FALSE);

ALTER TABLE cortes_transversales.registro_refresh_matview OWNER TO "postgres";

-- Setear el campo  'fechahora_modificacion' con now() para cada nuevo insert en la tabla
ALTER TABLE cortes_transversales.registro_refresh_matview ALTER fechahora_modificacion
SET DEFAULT now();